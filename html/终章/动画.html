<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../../css/终章/解脱.css" type="text/css">
    <title>夜幕星河</title>
</head>
<body>
    <canvas id="canvas">    </canvas>
    <div class="menu">
        <div class="title">
            <div class="hd">
                <img src="../../img/light_bulb.png" alt="">
                <div class="line"></div>
                <p>浩瀚的宇宙为舞台</p>
                <p>深邃的夜幕为帘</p>
                <p>一颗颗流星在台前划过</p>
                <p>那幕布后又隐藏着什么呢</p>
            </div>
        </div>
        <div class="body">
            <div class="xing1">
                <a href="天鹅座.html">天鹅座的朦胧</a>
            </div>
            <div class="xing2">
                <a href="海豚座.html">海豚座的羞涩</a>
            </div>
            <div class="xing3">
                <a href="天琴座.html">天琴座的高洁</a>
            </div>
            <div class="xing4">
                <a href="织女星.html">织女星的凝望</a>
            </div>
            <div class="xing5">
                <a href="北极星.html">北极星的魅力</a>
            </div>
        </div>
    </div>
    
    <!--音乐 START-->
	<audio controls autoplay class="audio">
        <source src="../../css/终章/月牙湾 (Live).mp3" type="audio/mp3"> 
    </audio>
<!--音乐 END-->
    
    <script>
            var can = document.getElementById("canvas");
            var ctx = can.getContext("2d");//设置绘图环境
            var w = can.width = window.innerWidth;//把窗口的宽度赋值给画布
            var h = can.height = window.innerHeight;//把窗口的高度赋值给画布
            var count = 80;//雨滴的个数
            var drops = [];//定义一个空数组来保存雨滴个数
            //浏览器窗口改变的时候重新获取宽度
            window.onresize = function(){
                w = can.width = window.innerWidth;
                h = can.height = window.innerHeight;
            }
            function Drop(){}//定义雨滴对象
            //添加原型对象方法
            Drop.prototype = {
                init : function(){//初始化
                    this.x = random(-400,w);
                    this.y = 0;
                    this.r = 1;//初始半径
                    this.vy = random(3,4);//竖直方向的加速度
                    this.vx = random(3,4);//竖直方向的加速度
                    this.a = 1;//初始透明度
                    this.va = 0.96;//透明度的变化系数
                    this.l = random(h*0.4,h*1.1);//雨滴下落的高度
                },
                draw : function(){
                    if (this.y > this.l)
                    {
                        ctx.beginPath();
                        ctx.arc(this.x,this.y,this.r,0,2*Math.PI,false);
                        ctx.strokeStyle = "white";
                        ctx.stroke();
                    }else{
                        ctx.fillStyle = color(this.a);
                        ctx.fillRect(this.x,this.y,2,2);
                    }
                    this.update();
                },
                //更新坐标
                update : function(){
                    if (this.y < this.l&&this.x<w)
                    {
                        this.y += this.vy;
                        this.x +=this.vx;
                    }else{
                        if (this.a > 0.03)
                        {
                            this.a *= this.va;
                        }else{
                            this.init();
                        }
                    }
                }
            }
            //不断的更新雨滴位置
            function move(){
                ctx.fillStyle = "rgba(0,0,0,.1)";
                ctx.fillRect(0,0,w,h);  //这个在先绘制
                for (var i=0;i<drops.length;i++ )
                {
                    drops[i].draw();
                }
                //调用经动画
                requestAnimationFrame(move);
            }
            //创建一个雨滴实例对象
            //var drop = new Drop();
            //drop.init();
            //drop.draw();
            //延迟产生每个雨滴
            function setup(){
                for (var i=0;i < count ;i++ )
                {
                    (function(j){
                        setTimeout(function(){
                            var drop = new Drop();
                            drop.init();
                            drops.push(drop);
                        },j*200);
                    }(i))
                }
            }
            setup();
            move();
            //封装一个产生随机数的方法
            function random(min,max){
                return Math.random()*(max-min) + min;
            }
            //封装一个随机颜色
            function color(a){
                return "white"
            }
        </script>
</body>
</html>